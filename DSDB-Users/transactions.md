# Transactions

## ACID

A PostgreSQL transaction is atomic, consistent, isolated, and durable. These properties are often referred to as ACID

* Atomicity guarantees that the transaction completes in an all-or-nothing manner.
* Consistency ensures the change to data written to the database must be valid and follow predefined rules.
* Isolation determines how transaction integrity is visible to other transactions.
* Durability makes sure that transactions that have been committed will be stored in the database permanently.

### Setting up a sample table

Since we don't have a meaningful use of transactions, banking will be used as example.

    DROP TABLE IF EXISTS accounts;

    CREATE TABLE accounts (
    id INT GENERATED BY DEFAULT AS IDENTITY,
    name VARCHAR(100) NOT NULL,
    balance DEC(15,2) NOT NULL,
    PRIMARY KEY(id)
    );

###Begin a transaction

In this case, you do not know when the transaction begins and cannot intercept the modification such as rolling it back.

    INSERT INTO accounts(name,balance)
    VALUES('Bob',10000);


    -- start a transaction
    BEGIN TRANSACTION;
    
    -- insert a new row into the accounts table
    INSERT INTO accounts(name,balance)
    VALUES('Alice',10000);
    
    -- commit the change (or roll it back later)
    COMMIT;


Total transactiono example

    -- start a transaction
    BEGIN;
    
    -- deduct 1000 from account 1
    UPDATE accounts
    SET balance = balance - 1000
    WHERE id = 1;
    
    -- add 1000 to account 2
    UPDATE accounts
    SET balance = balance + 1000
    WHERE id = 2;
    
    -- select the data from accounts
    SELECT id, name, balance
    FROM accounts;
    
    -- commit the transaction
    COMMIT;


Example with rollback

    -- begin the transaction
    BEGIN;
    
    -- deduct the amount from the account 1
    UPDATE accounts
    SET balance = balance - 1500
    WHERE id = 1;
    
    -- add the amount from the account 3 (instead of 2)
    UPDATE accounts
    SET balance = balance + 1500
    WHERE id = 3;
    
    -- roll back the transaction
    ROLLBACK;


Taken from 

    https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-transaction/
